var DB = require('database/database');
var Database = new DB();


//----------------------------------------------------------
// 	DEFINICION DEL MODULO
//

var Auth = function(){

}


/***********************************************
*           QUERYS AUTENTICATION               *
************************************************/

//----------------------------------------------------------
// 	VERIFICAR CREDENCIALES DEL USUARIO
//
Auth.prototype.check = function(dataUser, callback){
    
    var SQLCHECKUSER = "SELECT * FROM users WHERE email='"+dataUser.email+"' "+
    "AND password='"+dataUser.password+"'";

    Database.runQuery(SQLCHECKUSER,function(res){
      callback(res);
    });

}

Auth.prototype.guest = function(req, res, next){

	if(req.session.id){
        next();
	}else{
        res.redirect("/");
	}

}
// refistra variable de sesion en la base de datos
Auth.prototype.registerSession = function(idUser, session, callback){
    var SQLSAVESESSION = "UPDATE users SET session='"+session+"' WHERE id="+idUser;
    Database.runQuery(SQLSAVESESSION,function(res){
      callback(res);
    });
}

// elimina variable de sesion registrada en la base de datos
Auth.prototype.destroySession = function(idUser, callback){
    var SQLDESTROYSESSION = "UPDATE users SET session='' WHERE id="+idUser;
    Database.runQuery(SQLDESTROYSESSION,function(res){
      callback(res);
    });
}

// informacion del usuario que tiene la session activa
Auth.prototype.getSession = function(session, callback){
    var SQLGETSESSION = "SELECT * FROM users WHERE session="+session;
    Database.runQuery(SQLGETSESSION,function(res){
      callback(res);
    });
}

module.exports = Auth;

